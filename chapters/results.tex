% !TeX root = ../Thesis.tex
\chapter{Analysis}

% \definecolor{darkgray176}{RGB}{176,176,176}
% \definecolor{lightblue158218229}{RGB}{158,218,229}

% \begin{groupplot}[group style={group size=1 by 2}]
% \nextgroupplot[
% xlabel={$y$[m]},
% grid=both,
% xmin=1, xmax=3,
% ymin=0, ymax=1.5,
% y dir=reverse,
% ylabel={$x$ [m]},
% axis equal,
% legend entries={Actual Position,
%                 Replanned Target Path},
% ]
% \addlegendimage{no markers,red, thick}
% \addlegendimage{no markers,lightblue158218229, thick}
\begin{itemize}
	\color{red}
	\item Test the dynamic behavior of the body rates to assess whether the assumptions that they are reached slowly and by far not instantaneously holds.
	\item real time capability on limited hardware is required for deployment -> analysis of computation times required for assessment
	\item single trajectory tracking without implicit feedback, to analyze performance of (half) open loop trajectory tracking. while keeping disturbances at a minimum, this should show how susceptible the tracking performance is for errors in the assumed model parameters.
	\item Multi Trajectory/Implicit Feedback should show the full capability of the approach. Collision avoidance can be added optionally
\end{itemize}

\textcolor{blue}{
\section{(Experimental) Setup}
\begin{itemize}
    \item size of tank etc fresh water  / apriltag array inside
    \item add figure
\end{itemize}
\begin{table}[]
        \caption{Overview on ....}
		%\hspace*{-1.5cm}  % move table down (left in landscape) - tabular width: 
		\centering
		% change column width: >{\hsize=1.5\hsize\linewidth=\hsize}
		% >{\hsize=0.5\hsize\linewidth=\hsize}
		\begin{NiceTabular}
            {
            %%%%% Leider scheint die beste Methode wirklich hardgecodete Spaltenbreiten zu sein - hier am Ende rumspielen
            >{\centering\arraybackslash}m{3cm}  %
            >{\centering\arraybackslash}m{3cm} % 
            }
            \toprule
            %%%%%%%%%%% Top row - names of each columns
            Parameter &  Value \\  
            \midrule 
            %%%%%%%% Beispiel
            mass $m$ & $1$\,kg \\
            \bottomrule
		\end{NiceTabular}
		\label{tab:parameters}
\end{table}
\subsection{Qualisys Motion Capture System}
\begin{itemize}
    \item Figure sketch - 4 cameras inside the tank (+ maybe screenshot from QTM?)
    \item photo of sexy blue glowing cameras
    \item photo of hippocampus with reflective markers
    \item after conducting the QTM calibration procedure the estimated accuracy wihtin the calibration is XXXXXX according to the QTM calibration process.
\end{itemize}
}


\section{Body Rates Analysis}
\begin{figure}
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			no markers,
			width=0.9\textwidth,
			height=7cm,
			grid=both,
			% ymax=1.5,
			xmax=0.7,
			enlarge x limits=false,
			xlabel={Time [s]},
			ylabel={Angular rate [\unit{rad/s}]},
			]
			\addplot+[thick] table [x=t, y=v_ang, col sep=comma] {data/lab/rates_saturation.csv};
		\end{axis}
	\end{tikzpicture}
	\caption{Angular rate for thrusters in saturation around the vehicle's vertical axis $\ezbody$. Maximum rate is ca. \unit[6.15]{rad/s}}. \unit[63]{\%} of the maximum is reached around $\tau \approx \unit[0.3]{s}$.
\end{figure}

\begin{itemize}
	\color{red}
	\item Useful for myself to get reasonable values for the body rate limit
	\item Either use the body rate controller or just feed through
	\item Use step function and compute the time constant?
	\item Only test pitch/yaw. Roll is irrelevant
\end{itemize}

\section{Computational Performance}
\begin{figure}%[H]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			width=0.4\textwidth,
			height=7cm,
			boxplot/draw direction=y,
			xtick={0, ..., 5},
			xticklabels={Input Check, Collision Check, Input Feasible, Input Infeasible, Collision Feasible, Collision Infeasible},
			xticklabel style = {align=right, rotate=60, anchor=east},
			% x tick label as interval,
			ymajorgrids,
			% ytick distance={20},
			% minor y tick num=4,
			ymax=1250, ymin=0,
			% every box/.style={line, draw=mumblue, marker=o},
			% every whisker/.style={line, mumblue},
			cycle list={{mumblue}},
			ylabel={Computatino time [\unit{ns}]},
			xlabel={Zeitfenster},
			boxplot={
				draw position={\plotnumofactualtype}
			},
			]
			
			\pgfplotsforeachungrouped \i in {1,...,6}
			{
				\addplot+[boxplot, draw=mumblue, mark=none, thick] table [col sep=comma, y index=\i]{plots/perf_dat/t_all.dat};
			}
		\end{axis}
		% \node[below left] at (border.north east) {\ref{legend}};
	\end{tikzpicture}
	\caption{Computation time over 1000 samples. Input and collision feasibility check for all results and separated by feasibility result.}
	\label{fig:computation-time-desktop}
\end{figure}

\begin{itemize}
	\color{red}
	\item Measure the following
	\begin{itemize}
		\item generation time (expected to be constant, small variance due to running on a best effort machine)
		\item input feasibility (a recursive algorithm. maybe have a special look on worst case)
		\item position feasibility (only extrema need to be considered. small variance expected)
		\item collision avoidance ()
	\end{itemize}
	\item Tabular, or BoxPlot? Or Barplot? 
\end{itemize}

\section{Single Trajectory Tracking}


\section{Implicit Feedback}

\input{plots/sim/implicit/replanning_xy_perfect.tex}
\input{plots/sim/implicit/replanning_xy_damping_4.9.tex}
\input{plots/sim/implicit/replanning_xy_damping_4.4.tex}
\input{plots/sim/implicit/replanning_xy_damping_5.9.tex}
\input{plots/sim/implicit/replanning_xy_damping_6.4.tex}

\begin{figure}
	\centering
	\input{plots/sim/implicit/ring_all.tex}
	\caption{Intersections with the plane of the target object. The target object is visualized as black circle. High repeatability and accuracy as long as damping is not overestimated.}
\end{figure}

\begin{figure}
	\centering
	\subfloat[Trajectory tracking without implicit feedback.]{
		\centering
		\input{plots/lab/explicit/ring.tex}
	}
	\subfloat[Mixed implicit feedback and tracking controller.]{
		\centering
		\input{plots/lab/mixed/ring.tex}
	}
\end{figure}


